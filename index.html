<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>—</title>
  <style>
    html,body{height:100%;margin:0}
    body{
      background:#050508;
      overflow:hidden;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: rgba(255,255,255,.92);
    }
    canvas{position:fixed; inset:0; width:100%; height:100%;}
    #sky{z-index:0}
    #fx{z-index:1}

    .veil{
      position:fixed; inset:0; z-index:2; pointer-events:none;
      background:
        radial-gradient(1100px 800px at 50% 24%, rgba(255,255,255,.10), rgba(0,0,0,.88)),
        radial-gradient(900px 650px at 70% 30%, rgba(255,255,255,.06), rgba(0,0,0,0)),
        radial-gradient(900px 650px at 30% 75%, rgba(255,255,255,.05), rgba(0,0,0,0));
      opacity:.95;
    }

    .wrap{
      position:fixed; inset:0; z-index:3;
      display:flex; align-items:center; justify-content:center;
      padding: 18px;
    }
    .card{
      width: min(680px, 100%);
      border-radius: 26px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: 0 30px 150px rgba(0,0,0,.82);
      padding: 18px 16px 14px;
    }

    .top{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      user-select:none;
      margin-bottom: 10px;
    }
    .badge{
      display:inline-flex; align-items:center; gap:10px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-size: 12px;
      letter-spacing:.22px;
      font-weight: 900;
      text-transform: uppercase;
      color: rgba(255,255,255,.78);
    }
    .dot{
      width:9px; height:9px; border-radius:999px;
      background: rgba(255,255,255,.90);
      box-shadow: 0 0 18px rgba(255,255,255,.22);
      opacity:.9;
    }

    .actions{
      display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;
    }

    .btn{
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.90);
      padding: 9px 12px;
      font-weight: 900;
      letter-spacing:.2px;
      cursor:pointer;
      display:inline-flex; align-items:center; gap:8px;
      transition: transform .08s ease, background .35s ease, opacity .35s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:hover{ background: rgba(255,255,255,.10); }
    .btn:active{ transform: scale(.99); }

    .title{
      margin: 4px 0 10px;
      font-size: clamp(18px, 5vw, 22px);
      font-weight: 950;
      letter-spacing:.2px;
      color: rgba(255,255,255,.92);
      text-shadow: 0 18px 90px rgba(0,0,0,.82);
    }

    .box{
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      padding: 14px 12px;
      min-height: 210px;
    }

    .text{
      margin:0;
      font-size: 15.8px;
      line-height: 1.95;
      letter-spacing:.15px;
      color: rgba(255,255,255,.90);
      text-shadow: 0 8px 30px rgba(0,0,0,.72);
      white-space: pre-wrap;
      min-height: 140px;
    }

    .foot{
      margin-top: 10px;
      display:flex; justify-content:space-between; gap:10px;
      font-size: 12px;
      color: rgba(255,255,255,.55);
      user-select:none;
    }

    /* Floating hearts (DOM) */
    .hearts{
      position:fixed; inset:0; z-index:5; pointer-events:none;
      overflow:hidden;
    }
    .heart{
      position:absolute;
      left: var(--x);
      bottom: -30px;
      font-size: var(--s);
      opacity: 0;
      transform: translate(-50%, 0) scale(1);
      filter: drop-shadow(0 12px 40px rgba(0,0,0,.65));
      animation: floatUp var(--t) ease-in forwards;
      will-change: transform, opacity;
      user-select:none;
    }
    @keyframes floatUp{
      0%{opacity:0; transform: translate(-50%, 0) scale(.9)}
      10%{opacity:.9}
      70%{opacity:.85}
      100%{
        opacity:0;
        transform: translate(calc(-50% + var(--drift)), calc(-1 * var(--h))) rotate(var(--rot)) scale(1.12);
      }
    }

    /* Audio unlock */
    .unlock{
      position:fixed; inset:0; z-index:10;
      display:none;
      align-items:center; justify-content:center;
      padding: 18px;
      background: rgba(0,0,0,.68);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .unlock.show{display:flex}
    .unlockCard{
      width: min(520px, 100%);
      border-radius: 26px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.26);
      box-shadow: 0 30px 150px rgba(0,0,0,.86);
      padding: 16px 14px;
      text-align:center;
    }
    .unlockTitle{
      margin:0 0 8px;
      font-weight: 950;
      letter-spacing:.2px;
      font-size: 18px;
    }
    .unlockP{
      margin:0 0 12px;
      color: rgba(255,255,255,.72);
      font-size: 13.5px;
      line-height: 1.55;
    }
    .unlockBtn{
      width:100%;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.92);
      padding: 12px 14px;
      font-weight: 950;
      letter-spacing:.2px;
      cursor:pointer;
    }
    .unlockBtn:active{ transform: scale(.99); }
  </style>
</head>
<body>
  <canvas id="sky"></canvas>
  <canvas id="fx"></canvas>
  <div class="veil"></div>
  <div class="hearts" id="hearts"></div>

  <div class="wrap">
    <div class="card">
      <div class="top">
        <div class="badge"><span class="dot"></span>—</div>
        <div class="actions">
          <button class="btn" id="love">♥ Corazones</button>
          <button class="btn" id="replay">↺ Releer</button>
        </div>
      </div>

      <div class="title">Te amo</div>

      <div class="box">
        <p class="text" id="text"></p>
      </div>

      <div class="foot">
        <div id="stamp"></div>
        <div id="clock"></div>
      </div>
    </div>
  </div>

  <audio id="music" autoplay loop playsinline preload="auto">
    <source src="musica.mp3" type="audio/mpeg">
  </audio>

  <div class="unlock" id="unlock">
    <div class="unlockCard">
      <div class="unlockTitle">Toca una vez</div>
      <div class="unlockP">Para escuchar la melodía.</div>
      <button class="unlockBtn" id="unlockBtn">Escuchar</button>
    </div>
  </div>

  <script>
    // ===== Texto (tuyo + un poco más, sin exagerar) =====
    const full =
`Te amo… y aunque el tiempo pase,
no encuentro una forma honesta de dejar de hacerlo.

A veces me descubro deseando algo tan simple
como volver a verte,
abrazarte sin decir nada
y quedarme ahí, como si el mundo pudiera detenerse un momento.

Hay días en los que todo me recuerda a ti:
tu voz,
tus gestos,
la paz que tenía la vida cuando estabas.
Ahora todo se siente más lento… más vacío.

Tu ausencia duele.
Duele en silencio.
Pero aun así, te agradezco.
Porque fuiste un amor bonito,
de esos que no se olvidan,
de los que se quedan a vivir en el alma aunque ya no estén.

No te voy a mentir:
hay un vacío enorme en mi corazón.
Extraño saber de ti,
extraño leerte.
Y aunque comprendo tu silencio,
solo espero que estés bien.
Si algún día necesitas ser escuchada,
o simplemente leída…
aquí sigo, sin irme del todo.

A veces me encierro en mi habitación
y miro nuestras fotos.
Ahí todavía te encuentro,
en cada detalle,
en cada recuerdo que se niega a desaparecer.

Perdóname por amarte tanto
y no saber soltarte.
Creo en el amor…
y tal vez por eso no logro dejarte ir, Analú.
Han sido días difíciles,
días en los que solo he querido escucharte,
aunque sea una vez más.

No sé cómo seguir…
solo sé que me duele.
Tengo el corazón roto, mi Analú.

…
Te amo.`;

    // ===== Fecha y hora =====
    document.getElementById("stamp").textContent =
      new Date().toLocaleDateString("es-GT",{weekday:"long",year:"numeric",month:"long",day:"numeric"});
    const pad = n => String(n).padStart(2,"0");
    const d = new Date();
    document.getElementById("clock").textContent = `${pad(d.getHours())}:${pad(d.getMinutes())}`;

    // ===== Typewriter lento =====
    const textEl = document.getElementById("text");
    const replay = document.getElementById("replay");
    let tmr = null;

    function stop(){ if(tmr) clearTimeout(tmr); tmr=null; }

    function typeSlow(){
      stop();
      textEl.textContent = "";
      let i = 0;
      const base = 58;

      function tick(){
        const ch = full[i];
        if(ch === undefined) return;
        textEl.textContent += ch;
        i++;

        let delay = base;
        if(ch === "\n") delay = base * 9;
        if(".,;:".includes(ch)) delay = base * 3.0;
        if("!?".includes(ch)) delay = base * 4.2;
        if(ch === "…") delay = base * 7.0;

        tmr = setTimeout(tick, delay);
      }
      tick();
    }

    replay.addEventListener("click", typeSlow);
    typeSlow();

    // ===== Música: autoplay + fade-in + unlock si bloquea =====
    const music = document.getElementById("music");
    const unlock = document.getElementById("unlock");
    const unlockBtn = document.getElementById("unlockBtn");
    music.volume = 0;

    let raf = null;
    function fadeTo(target=0.70, ms=1700){
      target = Math.max(0, Math.min(1, target));
      if(raf) cancelAnimationFrame(raf);
      const start = music.volume;
      const t0 = performance.now();
      const step = (t)=>{
        const p = Math.min(1, (t - t0)/ms);
        const eased = 1 - Math.pow(1-p, 3);
        music.volume = start + (target - start) * eased;
        if(p < 1) raf = requestAnimationFrame(step);
      };
      raf = requestAnimationFrame(step);
    }

    async function tryPlay(){
      try{
        await music.play();
        fadeTo(0.70, 1700);
        unlock.classList.remove("show");
      }catch(e){
        unlock.classList.add("show");
      }
    }
    unlockBtn.addEventListener("click", tryPlay);
    tryPlay();

    const unlockOnTouch = async ()=>{
      if(unlock.classList.contains("show")) await tryPlay();
      window.removeEventListener("pointerdown", unlockOnTouch);
      window.removeEventListener("touchstart", unlockOnTouch);
      window.removeEventListener("click", unlockOnTouch);
    };
    window.addEventListener("pointerdown", unlockOnTouch, {passive:true});
    window.addEventListener("touchstart", unlockOnTouch, {passive:true});
    window.addEventListener("click", unlockOnTouch, {passive:true});

    // ===== Corazones =====
    const heartsLayer = document.getElementById("hearts");
    const loveBtn = document.getElementById("love");

    function spawnHeart(x = Math.random()*innerWidth){
      const el = document.createElement("div");
      el.className = "heart";
      el.textContent = "❤";
      const size = (16 + Math.random()*18).toFixed(0) + "px";
      const dur  = (2400 + Math.random()*2200).toFixed(0) + "ms";
      const drift = ((-60 + Math.random()*120).toFixed(0)) + "px";
      const height = (innerHeight*(0.55 + Math.random()*0.35)).toFixed(0) + "px";
      const rot = ((-18 + Math.random()*36).toFixed(0)) + "deg";

      el.style.setProperty("--x", x + "px");
      el.style.setProperty("--s", size);
      el.style.setProperty("--t", dur);
      el.style.setProperty("--drift", drift);
      el.style.setProperty("--h", height);
      el.style.setProperty("--rot", rot);

      heartsLayer.appendChild(el);
      // remove when animation ends
      el.addEventListener("animationend", ()=> el.remove());
    }

    function burstHearts(count=18){
      for(let i=0;i<count;i++){
        setTimeout(()=> spawnHeart(innerWidth*(0.25 + Math.random()*0.5)), i*55);
      }
    }

    loveBtn.addEventListener("click", ()=> burstHearts(22));
    // tap anywhere (nice on mobile)
    window.addEventListener("pointerdown", (e)=>{
      // avoid spawning when tapping buttons
      const t = e.target;
      if(t && (t.id === "love" || t.id === "replay" || t.id === "unlockBtn")) return;
      spawnHeart(e.clientX);
    }, {passive:true});

    // ===== Canvas: cielo + estrellas + neblina + hojas =====
    const skyC = document.getElementById("sky");
    const fxC  = document.getElementById("fx");
    const sky  = skyC.getContext("2d");
    const fx   = fxC.getContext("2d");

    let W=0,H=0,DPR=1;
    let stars = [];
    let leaves = [];
    let mist = [];

    function resize(){
      DPR = Math.max(1, Math.min(2, devicePixelRatio || 1));
      W = innerWidth; H = innerHeight;

      for(const c of [skyC, fxC]){
        c.width = Math.floor(W*DPR);
        c.height = Math.floor(H*DPR);
        c.style.width = W+"px";
        c.style.height = H+"px";
        const g = c.getContext("2d");
        g.setTransform(DPR,0,0,DPR,0,0);
      }

      initStars();
      initMist();
      initLeaves();
      drawSky(0);
    }
    addEventListener("resize", resize);

    function initStars(){
      stars = [];
      const n = Math.floor((W*H)/8500);
      for(let i=0;i<n;i++){
        stars.push({
          x: Math.random()*W,
          y: Math.random()*H,
          r: 0.6 + Math.random()*1.7,
          a: 0.05 + Math.random()*0.20,
          tw: 0.6 + Math.random()*1.7,
          ph: Math.random()*1000
        });
      }
    }

    function initMist(){
      mist = [];
      const n = 10;
      for(let i=0;i<n;i++){
        mist.push({
          x: Math.random()*W,
          y: Math.random()*H,
          r: 160 + Math.random()*260,
          a: 0.03 + Math.random()*0.05,
          vx: (-6 + Math.random()*12),
          vy: (-4 + Math.random()*8)
        });
      }
    }

    function makeLeaf(randomY){
      const r = 2.0 + Math.random()*6.4;
      return{
        x: Math.random()*W,
        y: randomY ? Math.random()*H : -80 - Math.random()*H*0.2,
        r,
        vx: 10 * (-0.9 + Math.random()*1.8),
        vy: 26 + Math.random()*86,
        rot: Math.random()*Math.PI*2,
        vr: (-1 + Math.random()*2) * 1.0,
        a: 0.07 + Math.random()*0.15,
        sway: 0.6 + Math.random()*1.9,
        t: Math.random()*1000
      };
    }

    function initLeaves(){
      leaves = [];
      const n = Math.floor((W*H)/12000);
      for(let i=0;i<n;i++) leaves.push(makeLeaf(true));
    }

    function drawSky(time){
      sky.clearRect(0,0,W,H);

      const g = sky.createLinearGradient(0,0,0,H);
      g.addColorStop(0, "rgba(10,10,16,1)");
      g.addColorStop(1, "rgba(2,2,5,1)");
      sky.fillStyle = g;
      sky.fillRect(0,0,W,H);

      const tt = time*0.00005;
      const cx = W*(0.52 + 0.05*Math.sin(tt*1.25));
      const cy = H*(0.22 + 0.05*Math.cos(tt*1.10));
      const rg = sky.createRadialGradient(cx,cy, 40, cx,cy, Math.max(W,H)*0.75);
      rg.addColorStop(0, "rgba(255,255,255,.10)");
      rg.addColorStop(1, "rgba(0,0,0,0)");
      sky.fillStyle = rg;
      sky.fillRect(0,0,W,H);

      sky.save();
      sky.globalCompositeOperation = "lighter";
      for(const m of mist){
        sky.globalAlpha = m.a;
        const gr = sky.createRadialGradient(m.x,m.y, 10, m.x,m.y, m.r);
        gr.addColorStop(0, "rgba(255,255,255,.10)");
        gr.addColorStop(1, "rgba(255,255,255,0)");
        sky.fillStyle = gr;
        sky.fillRect(m.x-m.r, m.y-m.r, m.r*2, m.r*2);
      }
      sky.restore();
      sky.globalAlpha = 1;

      for(const s of stars){
        const a = s.a * (0.7 + 0.3*Math.sin((time*0.001*s.tw)+s.ph));
        sky.globalAlpha = Math.max(0, a);
        sky.fillStyle = "rgba(255,255,255,1)";
        sky.beginPath();
        sky.arc(s.x, s.y, s.r, 0, Math.PI*2);
        sky.fill();
      }
      sky.globalAlpha = 1;
    }

    let last = performance.now();
    function loop(now){
      const dt = Math.min(0.033, (now-last)/1000);
      last = now;

      for(const m of mist){
        m.x += m.vx * dt;
        m.y += m.vy * dt;
        if(m.x < -300) m.x = W + 300;
        if(m.x > W + 300) m.x = -300;
        if(m.y < -300) m.y = H + 300;
        if(m.y > H + 300) m.y = -300;
      }

      drawSky(now);
      fx.clearRect(0,0,W,H);

      for(const f of leaves){
        f.t += dt;
        f.x += (f.vx + Math.sin(f.t*2*f.sway)*10) * dt;
        f.y += f.vy * dt;
        f.rot += f.vr * dt;

        if(f.y > H + 90) Object.assign(f, makeLeaf(false));
        if(f.x < -120) f.x = W + 120;
        if(f.x > W + 120) f.x = -120;

        fx.globalAlpha = f.a;
        fx.fillStyle = "rgba(255,255,255,1)";
        fx.save();
        fx.translate(f.x, f.y);
        fx.rotate(f.rot);
        fx.beginPath();
        fx.ellipse(0,0,f.r*1.2,f.r*0.7,0,0,Math.PI*2);
        fx.fill();
        fx.restore();
      }
      fx.globalAlpha = 1;

      requestAnimationFrame(loop);
    }

    resize();
    requestAnimationFrame(loop);
  </script>
</body>
</html>
